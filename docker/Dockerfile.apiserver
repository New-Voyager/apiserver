FROM node:14.7.0-alpine3.12

RUN apk --no-cache add yarn

WORKDIR /app

COPY . .
RUN mv ormconfig_postgres.json ormconfig.json

RUN yarn install --production=true && \
  yarn compile && \
  rm -rf /usr/local/share/.cache/yarn && \
  rm -rf /app/node_modules/typescript && \
  rm -rf /app/node_modules/prettier

# TOOD: Change to production cmd.
CMD ["yarn", "debug"]

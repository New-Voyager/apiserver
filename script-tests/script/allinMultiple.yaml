test:
  disabled: true

# Cleanup steps
cleanup:
  steps:

      # delete clubs and club members
    - delete-clubs:
        - name: chennai
        - name: newClub

# Setup steps
setup:
  steps:

      # register players if doesn't exist and store the player info
    - register-players: 
        - name: arun
          deviceId: 1edad270-1926-4634-b89b-9d5a62586d9e
        - name: arjun
          deviceId: c3744887-51d7-4ab9-b01b-0ea274577b04
        - name: sam
          deviceId: 1d43342c-84bf-4928-b5b4-ece904b66dd0
        - name: bala
          deviceId: 8ba53577-1318-4da3-adbd-0796234e405a   
 
      # create a club and pass the owner in the Auth header
      # store club info in a dictionary
    - create-clubs:
        - name: chennai
          owner: bala
        - name: newClub
          owner: sam

      # use joinClub API and auth header to join each player
    - join-clubs:
        - club: chennai
          members:     
            - arun
            - sam
        - club: newClub
          members:     
            - arun
            - arjun
            - bala

      # verify the players are waiting to be approved  (PENDING)
    - verify-club-members:
        - club: chennai
          members:
            - name: arun
              status: PENDING
            - name: sam
              status: PENDING
        - club: newClub
          members: 
            - name: arun
              status: PENDING
            - name: arjun
              status: PENDING
            - name: bala
              status: PENDING 

      # approve members with auth header (club.owner)
    - approve-club-members:
        - club: chennai
          members:     
            - arun
            - sam
        - club: newClub
          members:     
            - arun
            - arjun
            - bala

      # verify the players are approved  (ACTIVE)
    - verify-club-members:
        - club: chennai
          members:
            - name: arun
              status: ACTIVE
            - name: sam
              status: ACTIVE
        - club: newClub
          members: 
            - name: arun
              status: ACTIVE
            - name: arjun
              status: ACTIVE
            - name: bala
              status: ACTIVE

    #   # create game servers if does not exist
    # - create-game-servers:
    #     - ipAddress: 10.1.1.5
    #       currentMemory: 100
    #       status: ACTIVE
    #       url: http://server1:8080
    #     - ipAddress: 10.1.1.6
    #       currentMemory: 100
    #       status: ACTIVE
    #       url: http://server2:8080

# Game steps
game:
  steps:

    # configure game
    - configure-games:
        - club: chennai
          game: test1
          input:
            title: test1
            gameType: HOLDEM
            smallBlind: 1.0
            bigBlind: 2.0
            utgStraddleAllowed: true
            straddleBet: 4.0
            minPlayers: 2
            maxPlayers: 9
            gameLength: 60
            buyInApproval: false
            rakePercentage: 5.0
            rakeCap: 5.0
            buyInMin: 50
            buyInMax: 300
            actionTime: 100
        - club: chennai
          game: test2
          input:
            title: test2
            gameType: HOLDEM
            smallBlind: 1.0
            bigBlind: 2.0
            utgStraddleAllowed: true
            straddleBet: 4.0
            minPlayers: 2
            maxPlayers: 9
            gameLength: 60
            buyInApproval: false
            rakePercentage: 5.0
            rakeCap: 5.0
            buyInMin: 50
            buyInMax: 300
            actionTime: 100
        - club: newClub
          game: test3
          input:
            title: test3
            gameType: HOLDEM
            smallBlind: 1.0
            bigBlind: 2.0
            utgStraddleAllowed: true
            straddleBet: 4.0
            minPlayers: 2
            maxPlayers: 9
            gameLength: 60
            buyInApproval: false
            rakePercentage: 5.0
            rakeCap: 5.0
            buyInMin: 50
            buyInMax: 300
            actionTime: 100
        - club: chennai
          game: live game 1
          input:
            title: live game 1
            gameType: HOLDEM
            smallBlind: 1.0
            bigBlind: 2.0
            utgStraddleAllowed: true
            straddleBet: 4.0
            minPlayers: 2
            maxPlayers: 9
            gameLength: 60
            buyInApproval: false
            rakePercentage: 5.0
            rakeCap: 5.0
            buyInMin: 100
            buyInMax: 300
            actionTime: 100
        - club: newClub
          game: live game 2
          input:
            title: live game 2
            gameType: HOLDEM
            smallBlind: 1.0
            bigBlind: 2.0
            utgStraddleAllowed: true
            straddleBet: 4.0
            minPlayers: 2
            maxPlayers: 9
            gameLength: 60
            buyInApproval: false
            rakePercentage: 5.0
            rakeCap: 5.0
            buyInMin: 100
            buyInMax: 300
            actionTime: 100            
    # players sits in
    - sitsin:
        - club: chennai
          game: test1
          players:
            - playerId: arun
              seatNo: 1
              buyChips: 0
            - playerId: sam
              seatNo: 3
              buyChips: 0
            - playerId: bala
              seatNo: 5
              buyChips: 0
        - club: chennai
          game: test2
          players:
            - playerId: arun
              seatNo: 1
              buyChips: 0
            - playerId: sam
              seatNo: 3
              buyChips: 0
            - playerId: bala
              seatNo: 5
              buyChips: 0
        - club: newClub
          game: test3
          players:
            - playerId: arun
              seatNo: 1
              buyChips: 0
            - playerId: sam
              seatNo: 3
              buyChips: 0
            - playerId: bala
              seatNo: 5
              buyChips: 0
            - playerId: arjun
              seatNo: 8
              buyChips: 0
        - club: chennai
          game: live game 1
          players:
            - playerId: arun
              seatNo: 1
              buyChips: 0
            - playerId: sam
              seatNo: 3
              buyChips: 0
            - playerId: bala
              seatNo: 5
              buyChips: 0
        - club: newClub
          game: live game 2
          players:
            - playerId: arun
              seatNo: 1
              buyChips: 0
            - playerId: sam
              seatNo: 3
              buyChips: 0
            - playerId: bala
              seatNo: 5
              buyChips: 0
            - playerId: arjun
              seatNo: 8
              buyChips: 0              
    # players buy-in
    - buyin:
        - club: chennai
          game: test1
          players:
            - playerId: arun
              seatNo: 1
              buyChips: 100
            - playerId: sam
              seatNo: 3
              buyChips: 100
            - playerId: bala
              seatNo: 5
              buyChips: 100
        - club: chennai
          game: test2
          players:
            - playerId: arun
              seatNo: 1
              buyChips: 50
            - playerId: sam
              seatNo: 3
              buyChips: 50
            - playerId: bala
              seatNo: 5
              buyChips: 50
        - club: newClub
          game: test3
          players:
            - playerId: arun
              seatNo: 1
              buyChips: 100
            - playerId: sam
              seatNo: 3
              buyChips: 100
            - playerId: bala
              seatNo: 5
              buyChips: 100
            - playerId: arjun
              seatNo: 8
              buyChips: 100
        - club: newClub
          game: live game 2
          players:
            - playerId: arun
              seatNo: 1
              buyChips: 100
            - playerId: sam
              seatNo: 3
              buyChips: 100
            - playerId: bala
              seatNo: 5
              buyChips: 100
            - playerId: arjun
              seatNo: 8
              buyChips: 100
        - club: chennai
          game: live game 1
          players:
            - playerId: arun
              seatNo: 1
              buyChips: 100
            - playerId: sam
              seatNo: 3
              buyChips: 100
            - playerId: bala
              seatNo: 5
              buyChips: 100

    # verify club game balance
    - verify-club-game-stack:
        - club: chennai
          game: test1
          balance: 0
        - club: chennai
          game: test2
          balance: 0
        - club: newClub
          game: test3
          balance: 0

    # verify player game balance
    - verify-player-game-stack:
        - club: chennai
          game: test1
          players:
          - name: arun
            balance: 100
          - name: sam
            balance: 100
          - name: bala
            balance: 100
        - club: chennai
          game: test2
          players:
          - name: arun
            balance: 50
          - name: sam
            balance: 50
          - name: bala
            balance: 50
        - club: newClub
          game: test3
          players:
          - name: arun
            balance: 100
          - name: arjun
            balance: 100
          - name: sam
            balance: 100
          - name: bala
            balance: 100
    # start games
    - start-games:
        - club: chennai
          game: test1
        - club: chennai
          game: test2
        - club: newClub
          game: test3
        - club: chennai
          game: live game 1
        - club: newClub
          game: live game 2

    # save hands
    - save-hands:
        - clubId: chennai
          gameNum: test1
          handNum: 1
          messageType: RESULT
          handStatus: RESULT
          handResult:
            playersInSeats: [arun, 0, sam, 0, bala]
            handStartedAt: "1595385733"
            handEndedAt: "1595385739"
            preflopActions:
            flopActions:
            turnActions:
            riverActions:
            potWinners:
              0:
                hiWinners:
                  - seatNo: 1
                    amount: 50
                    winningCards: [200, 196, 8, 132, 1]
                    winningCardsStr: "[ A♣  A♦  2♣  T♦  2♠ ]"
                    rankStr: Two Pair
                    rank: 1000
                loWinners:
                  - seatNo: 1
                    amount: 50
                    winningCards: [200, 196, 8, 132, 1]
                    winningCardsStr: "[ A♣  A♦  2♣  T♦  2♠ ]"
                    rankStr: Two Pair
                    rank: 1000
            wonAt: SHOW_DOWN
            rank: 1000
            tips: 2.0
            totalPot: 150
            balanceAfterHand:
              - seatNo: 1
                playerId: arun
                balance: 200
              - seatNo: 3
                playerId: sam
                balance: 50
              - seatNo: 5
                playerId: bala
                balance: 0
        - clubId: chennai
          gameNum: test2
          handNum: 1
          messageType: RESULT
          handStatus: RESULT
          handResult:
            playersInSeats: [arun, 0, sam, 0, bala]
            handStartedAt: "1595385733"
            handEndedAt: "1595385739"
            preflopActions:
            flopActions:
            turnActions:
            riverActions:
            potWinners:
              0:
                hiWinners:
                  - seatNo: 1
                    amount: 50
                    winningCards: [200, 196, 8, 132, 1]
                    winningCardsStr: "[ A♣  A♦  2♣  T♦  2♠ ]"
                    rankStr: Two Pair
                    rank: 1000
                loWinners:
                  - seatNo: 1
                    amount: 50
                    winningCards: [200, 196, 8, 132, 1]
                    winningCardsStr: "[ A♣  A♦  2♣  T♦  2♠ ]"
                    rankStr: Two Pair
                    rank: 1000
            wonAt: SHOW_DOWN
            rank: 1000
            tips: 2.0
            totalPot: 150
            balanceAfterHand:
              - seatNo: 1
                playerId: arun
                balance: 200
              - seatNo: 3
                playerId: sam
                balance: 50
              - seatNo: 5
                playerId: bala
                balance: 0
        - clubId: newClub
          gameNum: test3
          handNum: 1
          messageType: RESULT
          handStatus: RESULT
          handResult:
            playersInSeats: [arun, 0, sam, 0, bala, 0, 0, arjun]
            handStartedAt: "1595385733"
            handEndedAt: "1595385739"
            preflopActions:
            flopActions:
            turnActions:
            riverActions:
            potWinners:
              0:
                hiWinners:
                  - seatNo: 1
                    amount: 50
                    winningCards: [200, 196, 8, 132, 1]
                    winningCardsStr: "[ A♣  A♦  2♣  T♦  2♠ ]"
                    rankStr: Two Pair
                    rank: 1000
                loWinners:
                  - seatNo: 1
                    amount: 50
                    winningCards: [200, 196, 8, 132, 1]
                    winningCardsStr: "[ A♣  A♦  2♣  T♦  2♠ ]"
                    rankStr: Two Pair
                    rank: 1000
            wonAt: SHOW_DOWN
            rank: 1000
            tips: 2.0
            totalPot: 150
            balanceAfterHand:
              - seatNo: 1
                playerId: arun
                balance: 200
              - seatNo: 3
                playerId: sam
                balance: 50
              - seatNo: 5
                playerId: bala
                balance: 0
              - seatNo: 8
                playerId: arjun
                balance: 50
    
    # End multiple games
    - end-games:
        - club: chennai
          game: test1
        - club: chennai
          game: test2
        - club: newClub
          game: test3

    # verify the balance of the clubs
    - verify-club-balance:
        - club: chennai
          balance: 4
        - club: newClub
          balance: 2

    # verify the balance of the club players
    - verify-player-balance:
        - club: chennai
          player: arun
          balance: 250
        - club: chennai
          player: sam
          balance: -50
        - club: chennai
          player: bala
          balance: -150
        - club: newClub
          player: bala
          balance: -100
        - club: newClub
          player: arun
          balance: 100
        - club: newClub
          player: sam
          balance: -50
        - club: newClub
          player: arjun
          balance: -50

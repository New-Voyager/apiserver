# Cleanup steps
cleanup:
  steps:

      # delete clubs and club members
    - delete-clubs:
        - name: chennai
        - name: newClub

# Setup steps
setup:
  steps:

      # register players if doesn't exist and store the player info
    - register-players: 
        - name: arun
          deviceId: 1edad270-1926-4634-b89b-9d5a62586d9e
        - name: arjun
          deviceId: c3744887-51d7-4ab9-b01b-0ea274577b04
        - name: sam
          deviceId: 1d43342c-84bf-4928-b5b4-ece904b66dd0
        - name: bala
          deviceId: 8ba53577-1318-4da3-adbd-0796234e405a   
 
      # create a club and pass the owner in the Auth header
      # store club info in a dictionary
    - create-clubs:
        - name: chennai
          owner: bala
        - name: newClub
          owner: sam

      # use joinClub API and auth header to join each player
    - join-clubs:
        - club: chennai
          members:     
            - arun
            - sam
        - club: newClub
          members:     
            - arun
            - arjun
            - bala

      # verify the players are waiting to be approved  (PENDING)
    - verify-club-members:
        - club: chennai
          members:
            - name: arun
              status: PENDING
            - name: sam
              status: PENDING
        - club: newClub
          members: 
            - name: arun
              status: PENDING
            - name: arjun
              status: PENDING
            - name: bala
              status: PENDING 

      # approve members with auth header (club.owner)
    - approve-club-members:
        - club: chennai
          members:     
            - arun
            - sam
        - club: newClub
          members:     
            - arun
            - arjun
            - bala

      # verify the players are approved  (ACTIVE)
    - verify-club-members:
        - club: chennai
          members:
            - name: arun
              status: ACTIVE
            - name: sam
              status: ACTIVE
        - club: newClub
          members: 
            - name: arun
              status: ACTIVE
            - name: arjun
              status: ACTIVE
            - name: bala
              status: ACTIVE

      # create game servers if does not exist
    - create-game-servers:
        - ipAddress: 10.1.1.5
          currentMemory: 100
          status: ACTIVE
        - ipAddress: 10.1.1.6
          currentMemory: 100
          status: ACTIVE

# game:
#   steps:
#     # configure game
#     -
#       config:
#         club: chennai   # preserve the club.id in current.clubId
#         input:
#           title: test1
#           gameType: HOLDEM
#           smallBlind: 1.0
#           bigBlind: 2.0
#           utgStraddleAllowed: true
#           straddleBet: 4.0
#           minPlayers: 2
#           maxPlayers: 9
#           gameLength: 60
#           buyInApproval: false
#           rakePercentage: 5.0
#           rakeCap: 5.0
#           buyInMin: 100
#           buyInMax: 300
#           actionTime: 100

#         # after the game is created, store the gameNum in current.gameNum
    
#     # players sits in
#     -
#       sitsin:    # /internal/player-sit-in
#         -
#           playerId: arun
#           seatNo: 1
#           buyChips: 0
#         -
#           playerId: arjun
#           seatNo: 5
#           buyChips: 0
#         -
#           playerId: sam
#           seatNo: 7
#           buyChips: 0
#         -
#           playerId: bala
#           seatNo: 8
#           buyChips: 0

#     # players buy-in
#     -
#       buyin:    # /internal/buy-chips
#         -
#           playerId: arun
#           buyChips: 100
#         -
#           playerId: arjun
#           buyChips: 100
#         -
#           playerId: sam
#           buyChips: 100
#         -
#           playerId: bala
#           buyChips: 100

#     -
#       hands:
#         -
#           save:   # /internal/save-hand
#             clubId: current.clubId    # use current.clubId captured in early steps
#             gameNum: current.gameNum  # use current.gameNum captured in early steps
#             handNum: 1
#             messageType: RESULT
#             handStatus: RESULT
#             handResult:
#               playersInSeats: [arun, 0, 0, 0, arjun, 0, sam, bala, 0]
#               handStartedAt: "1595385733"
#               handEndedAt: "1595385739"
#               preflopActions:
#               flopActions:
#               turnActions:
#               riverActions:
#               potWinners:
#                 0:
#                   hiWinners:
#                     -
#                       seatNo: 1
#                       amount: 50
#                       winningCards: [200, 196, 8, 132, 1]
#                       winningCardsStr: "[ A♣  A♦  2♣  T♦  2♠ ]"
#                       rankStr: Two Pair
#                       rank: 1000
#                   loWinners:
#                     -
#                       seatNo: 1
#                       amount: 50
#                       winningCards: [200, 196, 8, 132, 1]
#                       winningCardsStr: "[ A♣  A♦  2♣  T♦  2♠ ]"
#                       rankStr: Two Pair
#                       rank: 1000
#               wonAt: SHOW_DOWN
#               rank: 1000
#               tips: 2.0
#               totalPot: 150
#               balanceAfterHand:
#                 -
#                   seatNo: 1
#                   playerId: arun
#                   balance: 200
#                 -
#                   seatNo: 4
#                   playerId: arjun
#                   balance: 50
#                 -
#                   seatNo: 7
#                   playerId: sam
#                   balance: 50
#                 -
#                   seatNo: 8
#                   playerId: bala
#                   balance: 0
#           # verify club balance and player balance
#           verify-game-stack:
#             club:
#               name: chennai
#               balance: 2.0
#             players:
#               -
#                 name: arun
#                 balance: 200
#               -
#                 name: arjun
#                 balance: 50
#               -
#                 name: sam
#                 balance: 50
#               -
#                 name: bala
#                 balance: 0
#     -
#       end-game:   # /internal/game-ended
#         gameId: current.gameId
#         clubId: current.clubId

#     - verify-balance:
#         # verify the balance of the club
#         club:
#           name: chennai
#           balance: 2.0

#         # verify how much each player owes chips to the club
#         # and the clubs owes to the players
#         players:
#           -
#             name: arun
#             balance: 100    # borrowed 100 chips, left with 200 chips
#           -
#             name: arjun
#             balance: -50    # borrowed 100 chips, left with 50 chips
#           -
#             name: sam
#             balance: -50    # borrowed 100 chips, left with 50 chips
#           -
#             name: bala
#             balance: -100   # borrowed 100 chips, left with 0 chips
            